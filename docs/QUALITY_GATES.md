# Quality Gates and Rollback Criteria

This repository tracks six extension packages:

- `packages/ast`
- `packages/lsp`
- `packages/mcp`
- `packages/web-search`
- `packages/fuzzy-match`
- `packages/hashline-edit`

The goal is to stay implementation-wise better than upstream `oh-my-pi` features on security, correctness, performance, and maintainability.

## CI gates

Required checks:

1. `bun run check:ci`
2. `bun run test`
3. `bun run scorecard:check`

## Scorecard

The scorecard is generated by `scripts/scorecard.ts` and compares current package state against `scorecard/baseline.json`.

- `bun run scorecard` – print current report
- `bun run scorecard:check` – fail on regressions vs baseline
- `bun scripts/scorecard.ts baseline` – update baseline intentionally

## "Justified equal" definition

A package is allowed to be marked **equal** (instead of strictly better) only when all conditions hold:

1. Observable behavior is equivalent on compatibility tests.
2. Security posture is not weaker.
3. Performance is not worse beyond agreed tolerance.
4. Complexity/maintenance burden is lower (less code, fewer moving parts, or clearer architecture).

## Rollback criteria

Rollback or revert if any of the following occurs:

1. CI gate failure in `check:ci`, tests, or scorecard.
2. Security regression in target packages.
3. Incompatibility with expected tool interfaces used by pi.
4. Measurable performance regression beyond tolerance.

When a rollback happens, document the reason and remediation plan in the PR description.
